const app = require('../../src/app')
const truncate = require('../utils/truncate')

//external packages
const request = require('supertest')


describe('Authentication', () => {
   beforeEach(async () => {
      await truncate()
   })

   it('should return status 201 when user authenticated with valid credentials', async () => {

      userReq = {
         name: 'André Macena',
         email: 'andremacena97@gmail.com',
         password: 'andremacena10',
         roles: 'user',
         profile_url: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAgVBMVEX///8AAAD5+fn8/PwxMTGYmJiWlpYtLS2bm5s0NDSUlJQ4ODhwcHDs7Oxqamrn5+f09PStra07OzsYGBiFhYXFxcV1dXW/v7+mpqbq6uq1tbVAQEBZWVnNzc0VFRWJiYleXl7f399MTExOTk5mZmbU1NR+fn4fHx8mJiZFRUUODg7/PSaSAAAMaUlEQVR4nN1da2PiKhBNtN1226pptda2utb66OP//8ArJsAMIQ8yM8Tr+bRrDeF4YAaGAZKkAdl6mn6smr7VC1bLdDrLqKWM0hP+cNSIGYu8aiNiMdu8mPSOpVKcmBQ1W9KKyVKNs1NxoWtGa6eb9GwpznTFNqRiBpbhuTXUR12vIa2ch/RcVdQdaE4sZ3h1tiquTnX6IZczuAEUrxkqxofRerl7YyjnjFXkwgBSPK++yIXhzcVTRCr23BezgUixw3MxN2/HivyIzAPOpC/e5RV4lij7LJxGQTD9FSn9DJzGnXn/XqT83s3NH/t6kWbau4p34O3UWW8VelURKJiOxd4y7I8iVPBG8D2Dvz1RhApeyfj8Aj2pCAneEGe8TehFRdhEZRVUQObmVvptJ8RrojmGUMUYAzio4F/hJpojsorXkRU8IaaKqA9GUVABmRtZFXtRUCGW00BGpruC2Sb42UgqQgX/Bis42OQB/8ny+Pg8lOMwhrlBTTS4hvPjU8tXEzoObuPDe3GKkOB9KEFt8TOzwBE8GBJX8ZakoI5JzJJ/upCbYBVlB3DQyAQ7eht0mSa2mGAVRV0/UjD4xwdRJbPI20XFBPZFXhWRgqEPw7DZMnkm/VZS5gYqGOwmUNtaYYsVrqKMX0R+MPThcuCTNPsSUREq2NlNnFAEzNAMmmRReSiiJtrdiqZgWkCaYrKryKcgmPegSFawc+VVkaQgWkJCMV3SJIVVRdpQrWZ1hTTRZFRRSEEFmtPgUhEpGPpw0/rYOTgNdjeB0b/rR0009OE2K5x9Ow0RN4FBUpFMkUaw5Ro1zWk8kShCgk8kBWtnOaQlEKzi6HVywmZTmx6ZjU7ISAqGZPzwuX4Ij6LZ6vGw/Of9tqCCCqQIJXL9EA/4e6v1TcUXOykYmAoDmwvN9UOALJ/9vJrdEU+hr0RGplX/pzmNJ7fGOdb674sa9U4EZdwEBt8AzqLI5L31/hGAfajmh4CKC/Wnhe8vCFEUVOBX8Vjz/XcjwUgKKtCcxmep6keXuG7kl25l3QQGLfvheTYePxwxP+JwmC0GycRvYJ62u924wCw4l4uW2su7NPlSJrdc7InFUnO0mBYnTyiZ0PmKvmAd6ujrq0VT8YDpvb9QCtMId/RlkFZ/APAY5p4niZknjZCnLz4gghxbQBIeBRVo6+g5EMEHpnQKvkRQ0jrsCYggSwdM+BRUIC1zJZjg12vx4eZ6fP91P77tunOQd2kWDeCCVXwET/8UTz+/2486WR3u3R8kpwF+7I/8k8EHbLbpOLzp8y+uU7JaygS/UozwmJ5APhZh1v+rn9vl/89cgsGhX04jY4GcRpCKejRTECwpqBC0zVUqxaVzXxx8NyiosE9eDtvv7+3DW+PGc7kEl86uf3hU8WuR/zubegmmYGY8r+comWVOcP260hUKOnisKUk20ayt6x8OKvgjBe+yJKuY9B8qi5ZO+Wzj+l/Gpxa3vC03NqRgLtQs9WJdejaH/DbPRnMDQ2kPDkekYNESs9QP/0AnRgJ9vevPnCgiirp4FEzgeABh6nt5nN06da7/tVRRYDOyf77PB6VHyk+a74o4+jKqXb+vtmau5GuiCc4cQHgvvVg4lxWg0mls3VoqZLUE4bzj37HvbX7cBw1ibmKBFD/tx7C2Fvmamr+JokemOSXzS7i2BoaYxXfpQIrGmIy8BNN0krRTsNDMGGMnmAOjrRE2kwGKxjmDNjrd2Qmuymppr2Bis3kX+JUgGhllt5ylqFd2QXVV3SZGtasQBas1tKGQONsBLcWCIWijeQ0m5v+TZoJGwWRoZpNOPzQMIxG0jAqGto1qM79LPbAE37wKJtaWOr7WMJTape7CSJQzBIM1HUzzebomBRPbf7fOCw3DiTAzDcwQtFFjIMZtFfQSLIVVe2ZofZU5lMrjPJqMDCRY6m/9MvS00QQHDFsp6AzbP9GQsFeGvjb6nLpoNDLv7hNoSBidoZnXzaD9swenlXK5/E30q4YgGhLGZ2gi2c+wjRpLXjKk4QoqgHFNfIb5aXdHow4mhYbGxK1qo5uoSKOyXzBLrNEY5j1tB9uobVTuPMqv4G+Dgik0qD0wTJL9apR426ibddHYRKGCV3fXNt3IBjMMQ2OtI8HXRl0zY/+w9xOECs7UBzaOYH4180tGoQVg26gdZjkSgogLyAWraKKz/CMzhDDjbx0iiTXw1gB2w9YYh3lhMMp+WmFkZm65dg6V6++k4YoDxJ7AdA6lzsCYmWVY10QV3jzFZrfztdABX9WwWTLwNGboEHBQUM8UGxQEw/bolDCA24ORMdAYnahnIU19H0xgT47pGzywkQUccjBtrBTWPVnE9/YEo1tODDvi/nT+UlD0pM5kb2/gOEBI0K43gVF71QpNJNh1o1JbGjwe5o9Nq6hDfx+EzoZ8Yj4JQ1OPjibcTxDNu2J7Pww7Aus0kEIKepuowpUe1GzeGNJRA7HUteh2hOFPG4K6BwxOL2PKaWwL6xM6nSQKl1LrCOZ9sZiNxvWOppF2O6QRSGgJelLBT4MJ/fk3V+VbgRiEtouB9QqelDNWW+bg2QqYWH23CZuJxTUomKo9JmYsT70iIARmxNax5azqFfyZgyXtV8udqfZtYF46a/6uF3fO00hBlVdrGS9sPkPE+3xMNK1zVvNqvpzbCiOC+RjJrG8d7CQm4jDOLC3RLkDR8BC0/mhr2nT4vq/uMHkDLKX5CNr59Q8YIcYbqeo3spyN7iVo41YfwPRG64jm93XX+brg2UvQjszXoE8uasphhekjO3pZAz9BM+5VgzXTEavTFplhZr8MJ4cvGgiqrg6sTiQYh88wygDRR2uYAcGTz4R0o4CToY1wexXMzSev7W4BToamLK+CxazQfBLrmF1OhtpQ+hUsTIsZYUTPNmEZ7b8c2+DYVh0S1DEgM1mLtfY0cWvACB/BvrNNWOEleEkM/QQviGEFwcthWEUwPkM3N5EJlQTj5ya6+aU8qCYYPb+0nCPMgY9qgrFzhH153nTUKBg7zxvm6nNtr69XMHKuPiRIv+RUo1bBBK+mRtxQwnehRr2CScw9M923PNehScEk3r4n2mF1VWhUUCHO3jXShRqVaEUwzv7Dnvqghnxf7FVBBWkVqce4+BFAUHovN/0oHh8gwRYhEcn9+BzHKZURpKCC3JkKPRsZCylzI+PoOxCUcv09OvoyJFx/724Cg99pnE0f1ODui7SzviowhNtOgiPnvCqKuIkMnkbbIRTCqaJIH0QL253WPvjMjYSCQ7RhoWMwi+vcRIkrMl9+GQhyqch1finAHubOkpbnOFTkd/Qvzs69rmlxJ9BV5DxHWGFTOvmKmB5DdRqcfTDbL8blix7Iac00p0E7z/tlPjb48B+0rxLxHw+HgzryWx39PR7PgwPMlNO/uM9kL+FwbLalDyOeyS5xOwLEzR5uSrGIdq6+yA0XANUXJUS6G0FYwT95kf6bSqKoKKrg1LiIimMTI6hIc/T1BEFut82pdCmGvjLU9dPuCqppolfu7Q5VF+oI3xUkcd/T7898sfLkaF97v91FxQCnwXhnV3EZ16gu/Xyy2eQXe72OIt3ZdfH3rl383XkXf//hxd9heVn3kHpUPI+7ZBHF0IfrXf/l3QfsqMjn6KkxaCGLepn3cgMV+3YTGHzmxqiIhmrBBPnTB0gq+hoqyU0MuBVUYL68mjZUk1lXZ3X9cCIarqBUhgufiiuYGEjrg51ur6sE2zXyS3B6f7CbEM00Y3Maibm04JwUVEAqdreoU3OwRrijl84V5FFxrTfZ0oyMTL4nTcVCgCxJXtWiZfDlYFEu1CBlEQzVyXY/+Y7FbBM8W4qgoAItj2Cw6X4IQ5wrURJHRcH3uOC7QbIRMom7TRiWRn6CQOkSwu/SiKiggkxeXR2iKqggkPRSi+63mXeGTI55FbreR08CUlG4ocrffeaFTBKvD5GNjIXMXoEykIIxjIwFd4aWH730QQ2JPMkS+lNQgRSVbwe47h6zD2qIqwhzmOIrqABVlHD94L6V2H1QQ1hFq2E/CiogFfkpjntWUIGWFNqEQf8EiYtIjcgOv+lnz8f50xYC/x+QVfEswO7633bbdayTb9qBllRRQn7oRsQjfFsAqUgtTA/V+r2owAXsi8Rj8Yybr7vUvQdAFWldcaOLIW3gEQCgSDuu2RyOGu2A27awFIm2Ri8R93yrjQea4rL5q7UYnamEiTE3ZBuYzb7S5Xk5C43nz/TfoZHgfwUeko+sh7B8AAAAAElFTkSuQmCC'
      }

      const responseCreate = await request(app)
         .post('/users')
         .send(userReq)

      const response = await request(app)
         .post('/users/authenticate')
         .send({
            email: responseCreate.body.user.email,
            password: userReq.password
         })

      expect(response.status).toBe(200)
   })

   it('should return status 401 when user authenticated with invalid credentials', async () => {
      userReq = {
         name: 'André',
         email: 'andremacena@gmail.com',
         password: 'andremacena',
         roles: 'user',
         profile_url: 'data:image/png;base64,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'
      }

      const responseCreate = await request(app)
         .post('/users')
         .send(userReq)

      const response = await request(app)
         .post('/users/authenticate')
         .send({
            email: responseCreate.body.user.email,
            password: 'user.password'
         })

      expect(response.status).toBe(401)
   })
})
